import{F as e}from"./Form-DFiLZ-eA.js";import{u as o}from"./useForm-P-62QDa8.js";import{u as n}from"./useValidator-1DdjF_MS.js";import{d as a,r as t,q as l,a as i,e as s,H as m,B as p,F as c,Q as r,o as u,c as d,k as f}from"./index-SLBLGd9V.js";import{g as b}from"./index-CuUyxFn4.js";import{E as h}from"./el-tag-tB5qNfCm.js";import{_ as v}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-y2oy7I9k.js";const w=a({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(a,{expose:w}){const{t:y}=f(),{required:g}=n(),P=a,S=t(!1),I=l([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:async e=>{const o=await k();1===e?(F([{field:"component",path:"componentProps.disabled",value:!1}]),C({component:i(L)})):(F([{field:"component",path:"componentProps.disabled",value:!0}]),void 0===o.parentId?C({component:"#"}):C({component:"##"}))}}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:async e=>{const o=await k();e&&0===o.type?C({component:"##"}):e||0!==o.type?1===o.type&&C({component:i(L)??""}):C({component:"#"})}}},optionApi:async()=>(await b()).data.list||[]},{field:"meta.title",label:y("menu.menuName"),component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:e=>{L.value=e}}}},{field:"name",label:y("menu.name"),component:"Input"},{field:"meta.icon",label:y("menu.icon"),component:"Input"},{field:"path",label:y("menu.path"),component:"Input"},{field:"meta.activeMenu",label:y("menu.activeMenu"),component:"Input"},{field:"status",label:y("menu.status"),component:"Select",componentProps:{options:[{label:y("userDemo.disable"),value:0},{label:y("userDemo.enable"),value:1}]}},{field:"permissionList",label:y("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:e=>{var o;return s(c,null,[null==(o=null==e?void 0:e.permissionList)?void 0:o.map((e=>s(h,{class:"mr-1",key:e.value,closable:!0,onClose:()=>(async e=>{var o;const n=await k();C({permissionList:null==(o=null==n?void 0:n.permissionList)?void 0:o.filter((o=>o.value!==e.value))})})(e)},{default:()=>[e.label]}))),s(m,{type:"primary",size:"small",onClick:()=>S.value=!0},{default:()=>[p("添加权限")]})])}}}},{field:"meta.hidden",label:y("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:y("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:y("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:y("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:y("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:y("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:y("menu.canTo"),component:"Switch"}]),_=l({component:[g()],path:[g()],"meta.title":[g()]}),{formRegister:j,formMethods:x}=o(),{setValues:C,getFormData:k,getElFormExpose:V,setSchema:F}=x,L=t("");r((()=>P.currentRow),(e=>{e&&(L.value=1===e.type?e.component:"",0===e.parentId?F([{field:"component",path:"componentProps.disabled",value:!0}]):F([{field:"component",path:"componentProps.disabled",value:!1}]),1===e.type?F([{field:"component",path:"componentProps.disabled",value:!1}]):F([{field:"component",path:"componentProps.disabled",value:!0}]),C(e))}),{deep:!0,immediate:!0}),w({submit:async()=>{const e=await V();if(await(null==e?void 0:e.validate().catch((e=>{})))){return await k()}}});const R=async e=>{const o=await k();C({permissionList:[...(null==o?void 0:o.permissionList)||[],e]})};return(o,n)=>(u(),d(c,null,[s(i(e),{rules:_,onRegister:i(j),schema:I},null,8,["rules","onRegister","schema"]),s(v,{modelValue:S.value,"onUpdate:modelValue":n[0]||(n[0]=e=>S.value=e),onConfirm:R},null,8,["modelValue"])],64))}});export{w as _};
