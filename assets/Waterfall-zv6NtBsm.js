import{d as e,S as t,r as a,Q as l,G as s,a as o,a5 as r,a6 as i,o as n,c as u,$ as d,F as p,C as c,f,t as h,V as g,n as v,j as m,R as x,i as y,w,e as $,a7 as _,a8 as b,k as j}from"./index-SLBLGd9V.js";import{d as k}from"./debounce-LO_gwpwV.js";import{_ as M}from"./ContentWrap.vue_vue_type_script_setup_true_lang-SF99PU52.js";import"./el-card-sKcKiu2J.js";import"./el-popper-bilUBKzH.js";const T=["src"],W=["src"],C=e({__name:"Waterfall",props:{data:t.arrayOf(t.any),reset:t.bool.def(!0),width:t.number.def(200),gap:t.number.def(20),props:t.objectOf(t.string).def({src:"src",height:"height"}),cols:t.number.def(void 0),loadingText:t.string.def("加载中..."),loading:t.bool.def(!1),end:t.bool.def(!1),endText:t.string.def("没有更多了"),autoCenter:t.bool.def(!0),layout:t.oneOf(["javascript","flex"]).def("flex")},emits:["loadMore"],setup(e,{emit:t}){const{getPrefixCls:y}=m(),w=y("waterfall"),$=t,_=e,b=a(),j=a([]),M=a(0),C=a(0),O=a(),E=a(0),R=a([]),z=()=>{const{layout:e}=_;"javascript"===e?(async()=>{R.value=[];const{props:e,width:t,gap:a}=_,l=_.data;await x();const s=o(b);if(!s)return;E.value=_.cols??Math.floor(s.clientWidth/(t+a));const r=l.length;for(let i=0;i<r;i++)if(i<o(E))j.value[i]=l[i][e.height],R.value.push({...l[i],top:0,left:i*(t+a)});else{let s=j.value[0],r=0;for(let e=1;e<o(E);e++)o(j)[e]<s&&(s=o(j)[e],r=e);j.value[r]+=l[i][e.height]+a,R.value.push({...l[i],top:s+a,left:r*(t+a)})}M.value=Math.max(...o(j)),C.value=o(E)*(t+a)-a})():"flex"===e&&(async()=>{const{width:e,gap:t}=_,a=_.data;await x();const l=o(b);if(!l)return;E.value=_.cols??Math.floor(l.clientWidth/(e+t));const s=a.length,r=new Array(o(E)).fill([]);for(let i=0;i<s;i++){const e=i%o(E);r[e]=[...r[e],a[i]]}R.value=r})()};return l((()=>[_.data,_.cols]),(()=>{z()}),{immediate:!0}),s((()=>{o(_.reset)&&r(window,"resize",k(z,300)),i(o(O),(([{isIntersecting:e}])=>{!e||_.loading||_.end||$("loadMore")}),{threshold:.1})})),(t,a)=>(n(),u("div",{class:v([o(w),"flex","items-center",{"justify-center":e.autoCenter}]),ref_key:"wrapEl",ref:b,style:d({height:`${"javascript"===e.layout?M.value+40:"auto"}px`})},["javascript"===e.layout?(n(),u("div",{key:0,class:"relative",style:d({width:`${C.value}px`,height:`${M.value+40}px`})},[(n(!0),u(p,null,c(R.value,((t,a)=>(n(),u("div",{class:v([`${o(w)}-item__${a}`,{absolute:"javascript"===e.layout}]),key:`water-${a}`,style:d({width:`${e.width}px`,height:`${t[e.props.height]}px`,top:`${t.top}px`,left:`${t.left}px`})},[f("img",{src:t[e.props.src],class:"w-full h-full block",alt:"",srcset:""},null,8,T)],6)))),128)),f("div",{ref_key:"loadMore",ref:O,class:"h-40px flex justify-center absolute w-full",style:d({top:`${M.value+e.gap}px`})},h(e.end?e.endText:e.loadingText),5)],4)):"flex"===e.layout?(n(),u("div",{key:1,class:"relative flex pb-40px",style:d({width:e.cols?"100%":"auto"})},[(n(!0),u(p,null,c(R.value,((t,a)=>(n(),u("div",{key:`waterWrap-${a}`,class:"flex-1",style:d({marginRight:a===R.value.length-1?"0":`${e.gap}px`})},[(n(!0),u(p,null,c(t,((t,l)=>(n(),u("div",{key:`waterWrap-${a}-${l}`,style:d({marginBottom:`${e.gap}px`,width:e.cols?"100%":`${e.width}px`,height:e.cols?"auto":`${t[e.props.height]}px`})},[f("img",{src:t[e.props.src],class:"w-full h-full block",alt:"",srcset:""},null,8,W)],4)))),128))],4)))),128)),f("div",{ref_key:"loadMore",ref:O,class:"h-40px flex justify-center absolute w-full items-center",style:{bottom:0}},h(e.end?e.endText:e.loadingText),513)],4)):g("",!0)],6))}}),O=e({__name:"Waterfall",setup(e){const t=a([]),l=()=>{const e=[];for(let t=0;t<20;t++){const t=_.number.int({min:100,max:500}),a=_.number.int({min:100,max:500});e.push({width:a,height:t,id:b(),image_uri:_.image.url({width:a,height:t})})}t.value=[...o(t),...e],o(t).length>=60&&(i.value=!0)};l();const{t:s}=j(),r=a(!1),i=a(!1),u=()=>{r.value=!0,setTimeout((()=>{l(),r.value=!1}),1e3)};return(e,a)=>(n(),y(o(M),{title:o(s)("router.waterfall")},{default:w((()=>[$(o(C),{data:t.value,loading:r.value,end:i.value,props:{src:"image_uri",height:"height"},onLoadMore:u},null,8,["data","loading","end"])])),_:1},8,["title"]))}});export{O as default};
