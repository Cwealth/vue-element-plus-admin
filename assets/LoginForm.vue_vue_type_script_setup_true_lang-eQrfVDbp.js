import{F as e}from"./Form-qHN5jLzI.js";import{d as o,b as a,a9 as t,m as r,u as s,q as l,e as n,F as i,H as c,I as d,r as u,Q as m,aa as p,ab as f,ac as g,o as h,i as v,a as w,O as y,k as b}from"./index-eSpxw_vp.js";import{E as R}from"./el-checkbox-oRJQwT1M.js";import{E as P}from"./el-link-NH_qZ0Cu.js";import{u as j}from"./useForm-e10k02TE.js";import{u as x}from"./useValidator-TXxFGpxA.js";function I(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)}const k="#999",z="var(--el-color-primary)",D=o({__name:"LoginForm",emits:["to-register"],setup(o,{emit:y}){const{required:D}=x(),E=y,F=a(),C=t(),q=r(),{currentRoute:A,addRoute:O,push:S}=s(),{t:V}=b(),_={username:[D()],password:[D()]},L=l([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>n("h2",{class:"text-2xl font-bold text-center w-[100%]"},[V("login.login")])}}},{field:"username",label:V("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:V("login.usernamePlaceholder")}},{field:"password",label:V("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:V("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return n(i,null,[n("div",{class:"flex justify-between items-center w-[100%]"},[n(R,{modelValue:U.value,"onUpdate:modelValue":e=>U.value=e,label:V("login.remember"),size:"small"},null),n(P,{type:"primary",underline:!1},I(e=V("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return n(i,null,[n("div",{class:"w-[100%]"},[n(c,{loading:B.value,type:"primary",class:"w-[100%]",onClick:J},I(e=V("login.login"))?e:{default:()=>[e]})]),n("div",{class:"w-[100%] mt-15px"},[n(c,{class:"w-[100%]",onClick:T},I(o=V("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:V("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>n(i,null,[n("div",{class:"flex justify-between w-[100%]"},[n(d,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:z},null),n(d,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:z},null),n(d,{icon:"ant-design:alipay-circle-filled",size:30,color:k,hoverColor:z,class:"cursor-pointer ant-icon"},null),n(d,{icon:"ant-design:weibo-circle-filled",size:30,color:k,hoverColor:z,class:"cursor-pointer ant-icon"},null)])])}}}]),U=u(!1),{formRegister:H,formMethods:M}=j(),{getFormData:N,getElFormExpose:Q}=M,B=u(!1),G=u("");m((()=>A.value),(e=>{var o;G.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const J=async()=>{const e=await Q();await(null==e?void 0:e.validate((async e=>{if(e){B.value=!0;const e=await N();try{const o=await p(e);o&&(C.setUserInfo(o.data),F.getDynamicRouter?K():(await q.generateRoutes("static").catch((()=>{})),q.getAddRouters.forEach((e=>{O(e)})),q.setIsAddRouters(!0),S({path:G.value||q.addRouters[0].path})))}finally{B.value=!1}}})))},K=async()=>{const e={roleName:(await N()).username},o=F.getDynamicRouter&&F.getServerDynamicRouter?await f(e):await g(e);if(o){const e=o.data||[];C.setRoleRouters(e),F.getDynamicRouter&&F.getServerDynamicRouter?await q.generateRoutes("server",e).catch((()=>{})):await q.generateRoutes("frontEnd",e).catch((()=>{})),q.getAddRouters.forEach((e=>{O(e)})),q.setIsAddRouters(!0),S({path:G.value||q.addRouters[0].path})}},T=()=>{E("to-register")};return(o,a)=>(h(),v(w(e),{schema:L,rules:_,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:w(H)},null,8,["schema","onRegister"]))}});export{D as _};
